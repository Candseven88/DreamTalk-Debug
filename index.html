<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamTalk Box - Bedtime Stories with Your Voice</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #fcf2f7;
            color: #5a3d5c;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            position: relative;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: #e86ed0;
            margin-bottom: 10px;
            display: inline-block;
            position: relative;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .logo i {
            margin-right: 10px;
            animation: twinkle 2s ease-in-out infinite;
        }
        
        @keyframes twinkle {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .tagline {
            font-size: 1.2rem;
            color: #9d7e9f;
            margin-bottom: 30px;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 15px 30px;
            border-radius: 50px;
            border: none;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn i {
            margin-right: 10px;
            font-size: 1.3rem;
        }
        
        .btn-primary {
            background-color: #e86ed0;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #d64bbd;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(232, 110, 208, 0.3);
        }
        
        .btn-secondary {
            background-color: #a1d2ce;
            color: #3a6f6a;
        }
        
        .btn-secondary:hover {
            background-color: #8bc4bf;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(161, 210, 206, 0.3);
        }
        
        .story-section {
            margin: 50px 0;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8rem;
            color: #5a3d5c;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            display: block;
            width: 80px;
            height: 4px;
            background-color: #e86ed0;
            margin: 10px auto;
            border-radius: 2px;
        }
        
        .story-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .story-card {
            background-color: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .story-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        .story-image {
            height: 200px;
            overflow: hidden;
        }
        
        .story-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .story-card:hover .story-image img {
            transform: scale(1.05);
        }
        
        .story-content {
            padding: 20px;
        }
        
        .story-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #5a3d5c;
        }
        
        .story-description {
            color: #9d7e9f;
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .story-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        .story-age {
            font-size: 0.8rem;
            color: #a1d2ce;
            font-weight: bold;
        }
        
        .story-play {
            color: #e86ed0;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        
        .story-play:hover {
            color: #d64bbd;
            transform: scale(1.2);
        }
        
        .how-it-works {
            background-color: white;
            padding: 50px 30px;
            border-radius: 30px;
            margin: 50px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }
        
        .steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .step {
            text-align: center;
            padding: 20px;
        }
        
        .step-icon {
            width: 80px;
            height: 80px;
            background-color: #fcf2f7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            color: #e86ed0;
        }
        
        .step-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #5a3d5c;
        }
        
        .step-description {
            color: #9d7e9f;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* 订阅计划样式 */
        .subscription-plans {
            padding: 60px 20px;
            background-color: #fcf2f7;
            border-radius: 30px;
            margin: 50px 0;
        }
        
        .section-description {
            text-align: center;
            color: #9d7e9f;
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .plans-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        
        .plan-card {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            padding: 30px;
            width: 100%;
            max-width: 300px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .plan-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(232, 110, 208, 0.15);
        }
        
        .plan-card.featured {
            border: 2px solid #e86ed0;
            transform: scale(1.05);
        }
        
        .plan-card.featured:hover {
            transform: scale(1.05) translateY(-10px);
        }
        
        .plan-badge {
            position: absolute;
            top: 12px;
            right: -30px;
            background-color: #e86ed0;
            color: white;
            padding: 5px 30px;
            font-size: 0.8rem;
            font-weight: bold;
            transform: rotate(45deg);
        }
        
        .plan-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #f0e6f2;
        }
        
        .plan-title {
            font-size: 1.5rem;
            color: #5a3d5c;
            margin-bottom: 10px;
        }
        
        .plan-price {
            font-size: 2.2rem;
            font-weight: bold;
            color: #e86ed0;
        }
        
        .plan-price span {
            font-size: 1rem;
            color: #9d7e9f;
        }
        
        .plan-features {
            flex-grow: 1;
            margin-bottom: 25px;
        }
        
        .plan-features ul {
            list-style: none;
            padding: 0;
        }
        
        .plan-features li {
            margin-bottom: 15px;
            color: #5a3d5c;
            display: flex;
            align-items: center;
        }
        
        .plan-features i {
            color: #a1d2ce;
            margin-right: 10px;
            font-size: 0.9rem;
        }
        
        .plan-button {
            background-color: #a1d2ce;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            text-decoration: none;
        }
        
        .plan-button i {
            margin-left: 8px;
            transition: transform 0.3s ease;
        }
        
        .plan-button:hover {
            background-color: #8bc4bf;
        }
        
        .plan-button:hover i {
            transform: translateX(5px);
        }
        
        .featured .plan-button {
            background-color: #e86ed0;
        }
        
        .featured .plan-button:hover {
            background-color: #d55bbe;
        }
        
        @media (max-width: 992px) {
            .plans-container {
                gap: 20px;
            }
            
            .plan-card {
                max-width: 280px;
            }
        }
        
        @media (max-width: 768px) {
            .plan-card {
                max-width: 100%;
            }
            
            .plan-card.featured {
                transform: scale(1);
                order: -1;
                margin-bottom: 20px;
            }
            
            .plan-card.featured:hover {
                transform: translateY(-10px);
            }
        }
        
        footer {
            text-align: center;
            padding: 30px 0;
            color: #9d7e9f;
            font-size: 0.9rem;
            margin-top: 50px;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .footer-link {
            color: #5a3d5c;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-link:hover {
            color: #e86ed0;
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            .story-cards {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
        }
    </style>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-N2QVVC3591"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N2QVVC3591');
</script>
</head>
<body>
    <div class="container">
        <header>
            <!-- 在 header 部分添加用户登录区域 -->
            <header>
                <div class="logo">
                    <i class="fas fa-moon"></i> DreamTalk Box
                </div>
                <p class="tagline">Bedtime stories in your voice, creating magical dreams for your little ones</p>
                
                <!-- 添加用户登录区域 -->
                <div id="user-auth-container" style="position: absolute; top: 20px; right: 20px;">
                    <button id="login-button" class="auth-button">Login</button>
                    <div id="user-info" style="display: none;">
                        <span id="user-greeting"></span>
                        <button id="logout-button" class="auth-button">Logout</button>
                    </div>
                </div>
            </header>
        </header>
        
        <div class="action-buttons">
            <a href="record.html" class="btn btn-primary">
                <i class="fas fa-microphone"></i> Record Your Voice
            </a>
            <a href="story-upload.html" class="btn btn-secondary">
                <i class="fas fa-upload"></i> Upload Your Story
            </a>
        </div>
        
        <section class="story-section">
            <h2 class="section-title">Featured Stories</h2>
            <div class="story-cards" id="storyList">
                <!-- 动态加载故事会自动插入 -->
              </div>
                
                
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <a href="story-library.html" class="btn btn-secondary">
                    <i class="fas fa-book"></i> View All Stories
                </a>
            </div>
        </section>
        
        <section class="how-it-works">
            <h2 class="section-title">How It Works</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-microphone"></i>
                    </div>
                    <h3 class="step-title">Record Your Voice</h3>
                    <p class="step-description">Spend just a minute recording your voice, and our AI will learn to speak just like you.</p>
                </div>
                
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <h3 class="step-title">Choose a Story</h3>
                    <p class="step-description">Select from our library of bedtime stories or upload your own special tales.</p>
                </div>
                
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-moon"></i>
                    </div>
                    <h3 class="step-title">Sweet Dreams</h3>
                    <p class="step-description">Play the story in your voice to create a soothing bedtime routine for your child.</p>
                </div>
            </div>
        </section>
        
        <!-- 添加订阅计划部分 -->
        <section class="subscription-plans">
            <h2 class="section-title">Subscription Plans</h2>
            <p class="section-description">Choose the perfect plan for your family's bedtime story needs</p>
            
            <div class="plans-container">
                <!-- Starter Plan -->
                <div class="plan-card">
                    <div class="plan-header">
                        <h3 class="plan-title">Starter Plan</h3>
                        <div class="plan-price">$4.99<span>/month</span></div>
                    </div>
                    <div class="plan-features">
                        <ul>
                            <li><i class="fas fa-check"></i> Access to 20+ stories</li>
                            <li><i class="fas fa-check"></i> Basic voice customization</li>
                            <li><i class="fas fa-check"></i> 30 minutes of reading time</li>
                        </ul>
                    </div>
                    <a href="https://www.creem.io/payment/prod_4MFFcp902Sp1aXMWsBSuRG" class="plan-button">
                        Subscribe Now <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                
                <!-- Plus Plan -->
                <div class="plan-card featured">
                    <div class="plan-badge">Popular</div>
                    <div class="plan-header">
                        <h3 class="plan-title">Plus Plan</h3>
                        <div class="plan-price">$19.99<span>/month</span></div>
                    </div>
                    <div class="plan-features">
                        <ul>
                            <li><i class="fas fa-check"></i> Access to 50+ stories</li>
                            <li><i class="fas fa-check"></i> Advanced voice customization</li>
                            <li><i class="fas fa-check"></i> 2 hours of reading time</li>
                            <li><i class="fas fa-check"></i> Upload 5 custom stories</li>
                        </ul>
                    </div>
                    <a href="https://www.creem.io/payment/prod_m0Fosk4j2ceapiwZkf5Wg" class="plan-button">
                        Subscribe Now <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                
                <!-- Pro Plan -->
                <div class="plan-card">
                    <div class="plan-header">
                        <h3 class="plan-title">Pro Plan</h3>
                        <div class="plan-price">$49.99<span>/month</span></div>
                    </div>
                    <div class="plan-features">
                        <ul>
                            <li><i class="fas fa-check"></i> Access to all stories</li>
                            <li><i class="fas fa-check"></i> Premium voice customization</li>
                            <li><i class="fas fa-check"></i> Unlimited reading time</li>
                            <li><i class="fas fa-check"></i> Upload unlimited custom stories</li>
                            <li><i class="fas fa-check"></i> Perfect for educators & creators</li>
                        </ul>
                    </div>
                    <a href="https://www.creem.io/payment/prod_4Tezu3Ozv3ETbXMolp2dYr" class="plan-button">
                        Subscribe Now <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </section>
        
        <footer>
            <div class="footer-links">
                <a href="#" class="footer-link">About Us</a>
                <a href="#" class="footer-link">Privacy Policy</a>
                <a href="#" class="footer-link">Terms of Service</a>
                <a href="#" class="footer-link">Contact</a>
            </div>
            <p>© 2023 DreamTalk Box. All rights reserved.</p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Animation for story cards on scroll
            const storyCards = document.querySelectorAll('.story-card');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = 1;
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, { threshold: 0.1 });
            
            storyCards.forEach(card => {
                card.style.opacity = 0;
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                observer.observe(card);
            });
        });
        
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const storyList = document.getElementById('storyList');
            
            try {
                // 1. 加载系统故事
                const response = await fetch('stories.json');
                const systemStories = await response.json();
                
                // 2. 加载用户故事
                let userStories = [];
                try {
                    const userStoriesData = localStorage.getItem('userStories');
                    if (userStoriesData) {
                        userStories = JSON.parse(userStoriesData);
                    }
                } catch (error) {
                    console.warn('Failed to load user stories:', error);
                    // 如果解析失败，继续使用空数组
                }
                
                // 3. 合并故事并限制数量为8个
                // 系统故事优先，然后是用户故事
                const allStories = [...systemStories, ...userStories].slice(0, 8);
                
                // 清空占位内容
                storyList.innerHTML = '';
                
                // 4. 渲染故事卡片
                allStories.forEach(story => {
                    const card = document.createElement('div');
                    card.className = 'story-card';
                    
                    // 设置点击事件
                    card.onclick = () => location.href = `story-player.html?id=${story.id}`;
                    
                    // 处理封面图片 - 系统故事可能使用 cover 或 coverImage
                    const coverImage = story.cover || story.coverImage || 'covers/default.jpg';
                    
                    // 处理故事内容 - 确保有内容且截取前100个字符
                    const content = story.content ? story.content.substring(0, 100) + '...' : 'No description available...';
                    
                    // 处理年龄范围
                    const ageRange = story.ageRange || 'Age 3+';
                    
                    // 构建卡片HTML
                    card.innerHTML = `
                        <div class="story-image">
                            <img src="${coverImage}" alt="${story.title}" onerror="this.src='covers/default.jpg'">
                        </div>
                        <div class="story-content">
                            <h3 class="story-title">${story.title}</h3>
                            <p class="story-description">${content}</p>
                            <div class="story-footer">
                                <span class="story-age">${ageRange}</span>
                                <i class="fas fa-play-circle story-play"></i>
                            </div>
                        </div>
                    `;
                    
                    storyList.appendChild(card);
                });
                
                // 如果没有故事可显示
                if (allStories.length === 0) {
                    storyList.innerHTML = '<p style="text-align: center; width: 100%;">No stories available. Try adding your own!</p>';
                }
                
            } catch (err) {
                console.error('Failed to load stories:', err);
                storyList.innerHTML = '<p style="text-align: center; width: 100%;">Failed to load stories. Please try again later.</p>';
            }
        });
        </script>
        // 在文件末尾的 </body> 标签前添加以下脚本
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // 更新订阅计划描述
                updateSubscriptionPlansDescription();
                
                // 添加订阅模拟面板按钮（仅开发环境使用）
                addSubscriptionSimulationPanel();
            });
            
            // 更新订阅计划描述
            function updateSubscriptionPlansDescription() {
                // 获取所有计划卡片
                const planCards = document.querySelectorAll('.plan-card');
                
                if (planCards.length >= 3) {
                    // 更新 Free Plan (默认)
                    const freePlanFeatures = `
                        <li><i class="fas fa-check"></i> Access to 5 stories</li>
                        <li><i class="fas fa-check"></i> Up to 3 minutes per story</li>
                        <li><i class="fas fa-check"></i> Basic voice features</li>
                    `;
                    
                    // 更新 Starter Plan
                    const starterPlanFeatures = planCards[0].querySelector('.plan-features ul');
                    if (starterPlanFeatures) {
                        starterPlanFeatures.innerHTML = `
                            <li><i class="fas fa-check"></i> Access to 30 stories</li>
                            <li><i class="fas fa-check"></i> Up to 90 minutes total</li>
                            <li><i class="fas fa-check"></i> Basic voice customization</li>
                        `;
                    }
                    
                    // 更新 Plus Plan
                    const plusPlanFeatures = planCards[1].querySelector('.plan-features ul');
                    if (plusPlanFeatures) {
                        plusPlanFeatures.innerHTML = `
                            <li><i class="fas fa-check"></i> Access to 100 stories</li>
                            <li><i class="fas fa-check"></i> Up to 300 minutes total</li>
                            <li><i class="fas fa-check"></i> Advanced voice customization</li>
                            <li><i class="fas fa-check"></i> Upload 5 custom stories</li>
                        `;
                    }
                    
                    // 更新 Pro Plan
                    const proPlanFeatures = planCards[2].querySelector('.plan-features ul');
                    if (proPlanFeatures) {
                        proPlanFeatures.innerHTML = `
                            <li><i class="fas fa-check"></i> Access to 300 stories</li>
                            <li><i class="fas fa-check"></i> Up to 900 minutes total</li>
                            <li><i class="fas fa-check"></i> Premium voice customization</li>
                            <li><i class="fas fa-check"></i> Upload unlimited custom stories</li>
                            <li><i class="fas fa-check"></i> Perfect for educators & creators</li>
                        `;
                    }
                }
            }
            
            // 添加订阅模拟面板（仅开发环境使用）
            function addSubscriptionSimulationPanel() {
                // 检查是否为开发环境
                const isDevelopment = window.location.hostname === 'localhost' || 
                                     window.location.hostname === '127.0.0.1' ||
                                     window.location.hostname === '';
                
                if (isDevelopment) {
                    // 创建模拟面板按钮
                    const simulationButton = document.createElement('button');
                    simulationButton.textContent = 'Subscription Simulator';
                    simulationButton.style.position = 'fixed';
                    simulationButton.style.bottom = '20px';
                    simulationButton.style.right = '20px';
                    simulationButton.style.zIndex = '9999';
                    simulationButton.style.padding = '10px 15px';
                    simulationButton.style.backgroundColor = '#e86ed0';
                    simulationButton.style.color = 'white';
                    simulationButton.style.border = 'none';
                    simulationButton.style.borderRadius = '5px';
                    simulationButton.style.cursor = 'pointer';
                    simulationButton.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
                    
                    // 点击事件
                    simulationButton.addEventListener('click', function() {
                        showSubscriptionSimulator();
                    });
                    
                    // 添加到页面
                    document.body.appendChild(simulationButton);
                }
            }
            
            // 显示订阅模拟器
            function showSubscriptionSimulator() {
                // 获取当前订阅状态
                const currentPlan = localStorage.getItem('userPlan') || 'free';
                const playCount = localStorage.getItem('playCount') || 0;
                
                // 创建模拟器面板
                const panel = document.createElement('div');
                panel.style.position = 'fixed';
                panel.style.top = '50%';
                panel.style.left = '50%';
                panel.style.transform = 'translate(-50%, -50%)';
                panel.style.backgroundColor = 'white';
                panel.style.padding = '20px';
                panel.style.borderRadius = '10px';
                panel.style.boxShadow = '0 5px 15px rgba(0,0,0,0.3)';
                panel.style.zIndex = '10000';
                panel.style.minWidth = '300px';
                
                // 面板内容
                panel.innerHTML = `
                    <h3 style="margin-top:0;color:#5a3d5c;">Subscription Simulator</h3>
                    <p>Current Plan: <strong>${currentPlan}</strong></p>
                    <p>Play Count: <strong>${playCount}</strong></p>
                    
                    <div style="margin:15px 0;">
                        <label style="display:block;margin-bottom:5px;color:#5a3d5c;">Select Plan:</label>
                        <select id="plan-selector" style="width:100%;padding:8px;border-radius:5px;border:1px solid #ddd;">
                            <option value="free" ${currentPlan === 'free' ? 'selected' : ''}>Free</option>
                            <option value="starter" ${currentPlan === 'starter' ? 'selected' : ''}>Starter</option>
                            <option value="plus" ${currentPlan === 'plus' ? 'selected' : ''}>Plus</option>
                            <option value="pro" ${currentPlan === 'pro' ? 'selected' : ''}>Pro</option>
                        </select>
                    </div>
                    
                    <div style="margin:15px 0;">
                        <label style="display:block;margin-bottom:5px;color:#5a3d5c;">Play Count:</label>
                        <input type="number" id="play-count-input" value="${playCount}" style="width:100%;padding:8px;border-radius:5px;border:1px solid #ddd;">
                    </div>
                    
                    <div style="display:flex;justify-content:space-between;margin-top:20px;">
                        <button id="reset-button" style="padding:8px 15px;background:#a1d2ce;color:white;border:none;border-radius:5px;cursor:pointer;">Reset Count</button>
                        <button id="save-button" style="padding:8px 15px;background:#e86ed0;color:white;border:none;border-radius:5px;cursor:pointer;">Save Changes</button>
                        <button id="close-button" style="padding:8px 15px;background:#f0f0f0;color:#333;border:none;border-radius:5px;cursor:pointer;">Close</button>
                    </div>
                `;
                
                // 添加到页面
                document.body.appendChild(panel);
                
                // 添加事件监听
                document.getElementById('save-button').addEventListener('click', function() {
                    const selectedPlan = document.getElementById('plan-selector').value;
                    const newPlayCount = document.getElementById('play-count-input').value;
                    
                    localStorage.setItem('userPlan', selectedPlan);
                    localStorage.setItem('playCount', newPlayCount);
                    
                    alert(`Settings saved!\nPlan: ${selectedPlan}\nPlay Count: ${newPlayCount}`);
                    document.body.removeChild(panel);
                });
                
                document.getElementById('reset-button').addEventListener('click', function() {
                    document.getElementById('play-count-input').value = 0;
                });
                
                document.getElementById('close-button').addEventListener('click', function() {
                    document.body.removeChild(panel);
                });
            }
            
            // 检查并重置每月播放次数
            function checkAndResetMonthlyPlayCount() {
                const lastResetDate = localStorage.getItem('lastPlayCountReset');
                const currentDate = new Date();
                
                // 如果没有重置日期或者当前月份与上次重置月份不同
                if (!lastResetDate || new Date(lastResetDate).getMonth() !== currentDate.getMonth()) {
                    localStorage.setItem('playCount', 0);
                    localStorage.setItem('lastPlayCountReset', currentDate.toString());
                    console.log('Monthly play count has been reset');
                }
            }
            
            // 页面加载时检查是否需要重置计数
            checkAndResetMonthlyPlayCount();

            // 在现有的登录处理函数中添加获取订阅信息的逻辑
// 找到处理登录表单提交的代码部分，通常在 setupLoginSystem 函数中

// 处理登录表单提交
loginForm.addEventListener('submit', function(event) {
    event.preventDefault();
    
    const email = document.getElementById('email').value;
    const nickname = document.getElementById('nickname').value;
    const userPlan = document.getElementById('subscription').value;
    
    // 创建用户对象
    const user = {
        email: email,
        nickname: nickname,
        userPlan: userPlan // 初始使用表单中选择的计划
    };
    
    // 保存用户信息
    localStorage.setItem('user', JSON.stringify(user));
    
    // 初始化用户播放次数（如果不存在）
    if (!localStorage.getItem(`playCount_${email}`)) {
        localStorage.setItem(`playCount_${email}`, '0');
    }
    
    // 更新界面
    updateUserInterface();
    
    // 关闭模态框
    loginModal.style.display = 'none';
    
    console.log(`User logged in: ${nickname} (${email}) with ${userPlan} plan`);
    
    // 新增：获取用户的实际订阅信息
    fetchUserSubscription(email);
});

// 添加获取用户订阅信息的函数
function fetchUserSubscription(email) {
    if (!email) return;
    
    fetch(`/api/user-plan?email=${encodeURIComponent(email)}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch subscription data');
            }
            return response.json();
        })
        .then(data => {
            if (data && data.userPlan) {
                // 获取当前用户信息
                const userJson = localStorage.getItem('user');
                if (userJson) {
                    const user = JSON.parse(userJson);
                    
                    // 只有当订阅计划不同时才更新
                    if (user.userPlan !== data.userPlan) {
                        user.userPlan = data.userPlan;
                        localStorage.setItem('user', JSON.stringify(user));
                        console.log(`Updated user subscription to: ${data.userPlan}`);
                        
                        // 更新界面显示
                        updateUserInterface();
                    }
                }
            }
        })
        .catch(error => {
            console.error('Error fetching subscription:', error);
            // 失败时保持原有订阅计划，不做任何更改
        });
}

// 修改 updateUserInterface 函数，确保在页面加载时也检查订阅状态
function updateUserInterface() {
    const user = JSON.parse(localStorage.getItem('user'));
    const loginButton = document.getElementById('login-button');
    const userInfo = document.getElementById('user-info');
    const userGreeting = document.getElementById('user-greeting');
    
    if (user) {
        // 用户已登录 - 显示用户信息
        loginButton.style.display = 'none';
        userInfo.style.display = 'block';
        userGreeting.textContent = `Hi, ${user.nickname}! [${user.userPlan.charAt(0).toUpperCase() + user.userPlan.slice(1)}]`;
        
        // 如果用户已登录，检查订阅状态
        fetchUserSubscription(user.email);
    } else {
        // 用户未登录 - 显示登录按钮
        loginButton.style.display = 'block';
        userInfo.style.display = 'none';
    }
}
        </script>
</body>
</html>