<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Stories - DreamTalk Box</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #fcf2f7;
            color: #5a3d5c;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            position: relative;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: #e86ed0;
            margin-bottom: 10px;
            display: inline-block;
            position: relative;
        }
        
        .tagline {
            font-size: 1.2rem;
            color: #9d7e9f;
            margin-bottom: 30px;
        }
        
        .back-button {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            padding: 12px 25px;
            border-radius: 50px;
            background-color: #a1d2ce;
            color: #3a6f6a;
            text-decoration: none;
            font-weight: bold;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .back-button:hover {
            background-color: #8bc4bf;
            transform: translateY(-50%) translateX(-5px);
            box-shadow: 0 6px 20px rgba(161, 210, 206, 0.3);
        }
        
        .back-button i {
            margin-right: 8px;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2rem;
            color: #5a3d5c;
            position: relative;
        }
        
        .section-title::after {
            content: "";
            display: block;
            width: 80px;
            height: 4px;
            background-color: #e86ed0;
            margin: 10px auto;
            border-radius: 2px;
        }
        
        .story-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .story-card {
            background-color: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .story-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        .story-image {
            height: 200px;
            overflow: hidden;
        }
        
        .story-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .story-card:hover .story-image img {
            transform: scale(1.05);
        }
        
        .story-content {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .story-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #5a3d5c;
        }
        
        .story-description {
            color: #9d7e9f;
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.5;
            flex-grow: 1;
        }
        
        .story-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .story-age {
            font-size: 0.8rem;
            color: #a1d2ce;
            font-weight: bold;
            padding: 4px 12px;
            background-color: #f0f9f8;
            border-radius: 50px;
        }
        
        .story-category {
            font-size: 0.8rem;
            color: #e86ed0;
            font-weight: bold;
            padding: 4px 12px;
            background-color: #fcf2f7;
            border-radius: 50px;
        }
        
        .story-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }
        
        .edit-btn {
            background-color: #a1d2ce;
        }
        
        .edit-btn:hover {
            background-color: #8bc4bf;
            transform: scale(1.1);
        }
        
        .delete-btn {
            background-color: #ff7e7e;
        }
        
        .delete-btn:hover {
            background-color: #ff6060;
            transform: scale(1.1);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }
        
        .empty-state i {
            font-size: 4rem;
            color: #e0e0e0;
            margin-bottom: 20px;
        }
        
        .empty-state h3 {
            font-size: 1.5rem;
            color: #5a3d5c;
            margin-bottom: 15px;
        }
        
        .empty-state p {
            color: #9d7e9f;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 15px 30px;
            border-radius: 50px;
            border: none;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-decoration: none;
        }
        
        .btn i {
            margin-right: 10px;
        }
        
        .btn-primary {
            background-color: #e86ed0;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #d64bbd;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(232, 110, 208, 0.3);
        }
        
        footer {
            text-align: center;
            padding: 30px 0;
            color: #9d7e9f;
            font-size: 0.9rem;
            margin-top: 50px;
        }
        
        @media (max-width: 768px) {
            .back-button {
                position: static;
                transform: none;
                margin-bottom: 20px;
                display: inline-flex;
            }
            
            header {
                text-align: center;
                padding-top: 20px;
            }
            
            .story-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }
        
        @media (max-width: 480px) {
            .story-grid {
                grid-template-columns: 1fr;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-button">
                <i class="fas fa-arrow-left"></i> Back to Home
            </a>
            <div class="logo">DreamTalk Box</div>
            <p class="tagline">Your personal collection of bedtime stories</p>
        </header>
        
        <h1 class="section-title">My Stories</h1>
        
        <div id="storiesContainer">
            <!-- Stories will be loaded here dynamically -->
        </div>
        
        <footer>
            <p>¬© 2023 DreamTalk Box. All rights reserved.</p>
        </footer>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const storiesContainer = document.getElementById('storiesContainer');
            
            // Load user stories from localStorage
            const userStories = JSON.parse(localStorage.getItem('userStories')) || [];
            
            if (userStories.length === 0) {
                // Display empty state if no stories found
                storiesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book-open"></i>
                        <h3>You haven't uploaded any stories yet.</h3>
                        <p>Create your own bedtime stories to read to your little ones.</p>
                        <a href="story-upload.html" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Create New Story
                        </a>
                    </div>
                `;
            } else {
                // Create story grid and cards
                const storyGrid = document.createElement('div');
                storyGrid.className = 'story-grid';
                
                userStories.forEach(story => {
                    // Create story preview (first 60 characters)
                    const storyPreview = story.content ? 
                        story.content.substring(0, 60) + (story.content.length > 60 ? '...' : '') : 
                        'No content available';
                    
                    // Create story card
                    const storyCard = document.createElement('div');
                    storyCard.className = 'story-card';
                    storyCard.innerHTML = `
                        <div class="story-image">
                            <img src="${story.cover || 'covers/default.jpg'}" alt="${story.title}" onerror="this.src='covers/default.jpg'">
                        </div>
                        <div class="story-content">
                            <h3 class="story-title">${story.title || 'Untitled Story'}</h3>
                            <div class="story-meta">
                                <span class="story-age">Ages 3-7</span>
                                <span class="story-category">Bedtime</span>
                            </div>
                            <p class="story-description">${storyPreview}</p>
                            <div class="story-actions">
                                <div class="action-btn edit-btn" data-id="${story.id}">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div class="action-btn delete-btn" data-id="${story.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    storyGrid.appendChild(storyCard);
                });
                
                storiesContainer.appendChild(storyGrid);
                
                // Add event listeners for edit and delete buttons
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const storyId = this.getAttribute('data-id');
                        console.log('Edit story:', storyId);
                        // Placeholder for edit functionality
                        alert('Edit functionality will be implemented soon!');
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const storyId = this.getAttribute('data-id');
                        
                        if (confirm('Are you sure you want to delete this story?')) {
                            // Remove story from localStorage
                            const userStories = JSON.parse(localStorage.getItem('userStories')) || [];
                            const updatedStories = userStories.filter(story => story.id !== storyId);
                            localStorage.setItem('userStories', JSON.stringify(updatedStories));
                            
                            // Refresh the page to show updated list
                            location.reload();
                        }
                    });
                });
                
                // Make story cards clickable to view the story
                document.querySelectorAll('.story-card').forEach(card => {
                    card.addEventListener('click', function(e) {
                        // Only navigate if the click wasn't on a button
                        if (!e.target.closest('.action-btn')) {
                            const storyId = this.querySelector('.action-btn').getAttribute('data-id');
                            window.location.href = `story-player.html?id=${storyId}`;
                        }
                    });
                });
            }
        });
    </script>
<!-- üåü ËÆ¢ÈòÖÁ≠âÁ∫ßÊµÆÊ†áÔºàÊèíÂÖ•Âú®ÊØè‰∏™È°µÈù¢Â∫ïÈÉ®Ôºâ -->
<div id="subscription-badge" style="position: fixed; top: 15px; right: 15px; padding: 8px 12px; border-radius: 20px; font-size: 14px; font-weight: 500; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 1000; background-color: #f8f0ff; color: #6b46c1; transition: all 0.3s ease;"></div>

<script>
  (function() {
    if (!localStorage.getItem('userPlan')) {
      localStorage.setItem('userPlan', 'free');
    }
    const userPlan = localStorage.getItem('userPlan').toLowerCase();
    const badge = document.getElementById('subscription-badge');

    switch(userPlan) {
      case 'free':
        badge.innerHTML = 'üå± Plan: Free';
        badge.style.backgroundColor = '#f0f9ff';
        badge.style.color = '#3182ce';
        break;
      case 'starter':
        badge.innerHTML = 'üî∞ Plan: Starter';
        badge.style.backgroundColor = '#f0fff4';
        badge.style.color = '#38a169';
        break;
      case 'plus':
        badge.innerHTML = 'üöÄ Plan: Plus';
        badge.style.backgroundColor = '#faf5ff';
        badge.style.color = '#805ad5';
        break;
      case 'pro':
        badge.innerHTML = 'üëë Plan: Pro';
        badge.style.backgroundColor = '#fff5f7';
        badge.style.color = '#d53f8c';
        break;
      default:
        badge.innerHTML = 'üå± Plan: Free';
        badge.style.backgroundColor = '#f0f9ff';
        badge.style.color = '#3182ce';
    }

    badge.onmouseover = function() {
      this.style.transform = 'translateY(-2px)';
      this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.15)';
    };
    badge.onmouseout = function() {
      this.style.transform = 'translateY(0)';
      this.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
    };
    badge.onclick = function() {
  window.location.href = '/pricing';
};
  })();
</script>

<!-- Firebase App + Auth CDN -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<!-- Ëá™Âä®ÂåøÂêçÁôªÂΩïËÑöÊú¨ -->
<script>
  // ÂàùÂßãÂåñ Firebase + ÂåøÂêçÁôªÂΩï
  document.addEventListener('DOMContentLoaded', function() {
    // Firebase ÈÖçÁΩÆ
    const firebaseConfig = {
    apiKey: "AIzaSyD4fhwhOOFF7CBEWYnOplLiAh021905LAQ",
    authDomain: "dreamtalk-91c96.firebaseapp.com",
    projectId: "dreamtalk-91c96",
    storageBucket: "reamtalk-91c96.appspot.com",
    messagingSenderId: "1073825503044",
    appId: "1:1073825503044:web:c70d0c119795b66dab6911",
    measurementId: "G-XJZE5QM6W0"
  };

    // ÂàùÂßãÂåñ Firebase
    firebase.initializeApp(firebaseConfig);
    
    // Ëé∑Âèñ Auth ÂÆû‰æã
    const auth = firebase.auth();
    
    // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶Â∑≤ÁôªÂΩï
    auth.onAuthStateChanged(function(user) {
      if (user) {
        // Áî®Êà∑Â∑≤ÁôªÂΩïÔºå‰øùÂ≠ò UID Âà∞ localStorage
        localStorage.setItem('userId', user.uid);
        console.log('User is signed in with UID:', user.uid);
      } else {
        // Áî®Êà∑Êú™ÁôªÂΩïÔºåÊâßË°åÂåøÂêçÁôªÂΩï
        auth.signInAnonymously()
          .then(() => {
            console.log('Anonymous authentication successful');
          })
          .catch((error) => {
            console.error('Anonymous authentication error:', error.code, error.message);
          });
      }
    });
  });
</script>

<!-- my-stories.html È°µÈù¢ Firestore ËØªÂèñËÑöÊú¨ -->
<script>
    // È°µÈù¢Âä†ËΩΩ ‚Üí ‰ªé Firestore ËØªÂèñÁî®Êà∑ stories Ê∏≤Êüì
    document.addEventListener('DOMContentLoaded', function() {
      // ÂºïÂÖ• Firestore
      const firestoreScript = document.createElement('script');
      firestoreScript.src = 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js';
      firestoreScript.onload = fetchUserStories;
      document.head.appendChild(firestoreScript);
      
      async function fetchUserStories() {
        // Ëé∑Âèñ Firestore ÂÆû‰æã
        const db = firebase.firestore();
        
        // Ëé∑ÂèñÁî®Êà∑ID
        const userId = localStorage.getItem('userId');
        if (!userId) {
          console.error('User not logged in');
          displayMessage('Please log in to view your stories');
          return;
        }
        
        // Ëé∑ÂèñÊïÖ‰∫ãÂàóË°®ÂÆπÂô®
        const storiesContainer = document.getElementById('user-stories') || 
                                document.querySelector('.stories-grid') || 
                                document.querySelector('.stories-container');
        
        if (!storiesContainer) {
          console.error('Stories container not found');
          return;
        }
        
        try {
          // Êü•ËØ¢Áî®Êà∑ÁöÑÊïÖ‰∫ã
          const storiesSnapshot = await db.collection('users').doc(userId).collection('stories').get();
          
          if (storiesSnapshot.empty) {
            displayMessage('You haven\'t created any stories yet');
            return;
          }
          
          // Ê∏ÖÁ©∫ÂÆπÂô®
          storiesContainer.innerHTML = '';
          
          // Ê∏≤ÊüìÊïÖ‰∫ã
          storiesSnapshot.forEach(doc => {
            const story = doc.data();
            story.id = doc.id;
            
            // ÂàõÂª∫ÊïÖ‰∫ãÂç°Áâá
            const storyCard = createStoryCard(story);
            storiesContainer.appendChild(storyCard);
          });
          
          // ÂêåÊó∂Êõ¥Êñ∞ localStorage
          const stories = storiesSnapshot.docs.map(doc => {
            const data = doc.data();
            return {
              id: doc.id,
              title: data.title,
              content: data.content,
              coverUrl: data.coverUrl
            };
          });
          
          localStorage.setItem('userStories', JSON.stringify(stories));
          
        } catch (error) {
          console.error('Error fetching stories from Firestore:', error);
          displayMessage('Failed to load your stories');
        }
      }
      
      // ËæÖÂä©ÂáΩÊï∞ÔºöÂàõÂª∫ÊïÖ‰∫ãÂç°Áâá
      function createStoryCard(story) {
        const card = document.createElement('div');
        card.className = 'story-card';
        
        // ËÆæÁΩÆÂç°ÁâáÂÜÖÂÆπ - Ê†πÊçÆÂÆûÈôÖÈ°µÈù¢ÁªìÊûÑË∞ÉÊï¥
        card.innerHTML = `
          <div class="story-cover">
            <img src="${story.coverUrl || 'default-cover.jpg'}" alt="${story.title}" onerror="this.src='default-cover.jpg'">
          </div>
          <div class="story-info">
            <h3>${story.title}</h3>
            <p>${story.content.substring(0, 100)}${story.content.length > 100 ? '...' : ''}</p>
            <a href="story-player.html?id=${story.id}" class="read-button">Read Story</a>
          </div>
        `;
        
        return card;
      }
      
      // ËæÖÂä©ÂáΩÊï∞ÔºöÊòæÁ§∫Ê∂àÊÅØ
      function displayMessage(message) {
        const storiesContainer = document.getElementById('user-stories') || 
                                document.querySelector('.stories-grid') || 
                                document.querySelector('.stories-container');
        
        if (storiesContainer) {
          storiesContainer.innerHTML = `<div class="empty-message">${message}</div>`;
        }
      }
    });
  </script>
</body>
</html>